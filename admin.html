<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Gedalia Master Admin</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #c5a059; --black: #0a0a0a; --gray: #f4f7f6; --white: #ffffff; }
        body { font-family: 'Inter', sans-serif; background: var(--gray); display: flex; margin: 0; }
        .sidebar { width: 260px; background: var(--black); height: 100vh; color: white; padding: 40px 20px; position: fixed; }
        .main { margin-left: 260px; padding: 50px; width: 100%; }
        .card { background: var(--white); padding: 30px; border-radius: 15px; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
        .section { display: none; }
        .active { display: block; }
        input, select, button { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; }
        .btn-add { background: var(--black); color: white; font-weight: bold; cursor: pointer; }
        .btn-add:disabled { background: #888; }
        table { width: 100%; border-collapse: collapse; background: white; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #eee; }
    </style>
</head>
<body>

<div class="sidebar">
    <h2 style="color:var(--gold); text-align:center; letter-spacing:4px;">GEDALIA</h2>
    <button onclick="showSec('stats')" style="background:none; color:white; border:none; padding:15px; cursor:pointer; width:100%; text-align:left;">ðŸ“Š EstadÃ­sticas</button>
    <button onclick="showSec('inventory')" style="background:none; color:white; border:none; padding:15px; cursor:pointer; width:100%; text-align:left;">ðŸ’Ž Inventario</button>
    <button onclick="showSec('new')" style="background:none; color:white; border:none; padding:15px; cursor:pointer; width:100%; text-align:left;">âœ¨ Nueva Pieza</button>
</div>

<div class="main">
    <div id="stats" class="section active"><h3>EstadÃ­sticas de Vistas</h3><div class="card" id="top-views"></div></div>
    
    <div id="inventory" class="section">
        <div class="card">
            <h3>CatÃ¡logo Actual</h3>
            <table>
                <thead><tr><th>Imagen</th><th>Nombre</th><th>Precio</th><th>Acciones</th></tr></thead>
                <tbody id="lista-prods"></tbody>
            </table>
        </div>
    </div>

    <div id="new" class="section">
        <div class="card">
            <h3>Publicar Nueva Joya</h3>
            <input type="text" id="n" placeholder="Nombre de la pieza">
            <select id="c">
                <option value="Anillos">Anillos</option>
                <option value="Dije">Dije</option>
                <option value="Collares">Collares</option>
                <option value="Aretes">Aretes</option>
                <option value="Pulseras">Pulseras</option>
            </select>
            <input type="number" id="p" placeholder="Precio Base USD">
            <p style="font-size:12px; color:#888; margin-top:10px;">Subir imÃ¡genes (MÃ¡ximo 3):</p>
            <input type="file" id="file1" accept="image/*">
            <input type="file" id="file2" accept="image/*">
            <input type="file" id="file3" accept="image/*">
            <button class="btn-add" id="btn-publicar" onclick="subirTodo()">PUBLICAR EN TIENDA</button>
        </div>
    </div>
</div>

<script>
    function showSec(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        if(id === 'inventory') cargarInventario();
    }

    async function subirTodo() {
        const btn = document.getElementById('btn-publicar');
        btn.disabled = true;
        btn.innerText = "Subiendo imÃ¡genes...";

        try {
            const urls = [];
            const files = [document.getElementById('file1').files[0], document.getElementById('file2').files[0], document.getElementById('file3').files[0]];
            
            for(let file of files) {
                if(file) {
                    const fd = new FormData();
                    fd.append('image', file);
                    const res = await fetch('/api/admin/upload-image', { method: 'POST', body: fd });
                    const data = await res.json();
                    urls.push(data.url);
                }
            }

            const prod = {
                nombre: document.getElementById('n').value,
                categoria: document.getElementById('c').value,
                precioBase: document.getElementById('p').value,
                imagenes: urls
            };

            await fetch('/api/admin/productos', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(prod)
            });

            alert("Pieza publicada con Ã©xito.");
            location.reload();
        } catch (e) {
            alert("Error al subir.");
            btn.disabled = false;
        }
    }

    async function cargarInventario() {
        const res = await fetch('/api/admin/productos-todos');
        const prods = await res.json();
        document.getElementById('lista-prods').innerHTML = prods.map(p => `
            <tr>
                <td><img src="${p.imagenes[0]}" width="50"></td>
                <td>${p.nombre}</td>
                <td>$${p.precioBase}</td>
                <td><button onclick="eliminar('${p._id}')" style="color:red; cursor:pointer;">Borrar</button></td>
            </tr>
        `).join('');
    }

    async function eliminar(id) {
        if(confirm("Â¿Eliminar?")) {
            await fetch(`/api/admin/productos/${id}`, { method: 'DELETE' });
            cargarInventario();
        }
    }
</script>
</body>
</html>
