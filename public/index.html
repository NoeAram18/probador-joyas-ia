
<style>
    .galeria-preview { display: flex; gap: 5px; justify-content: center; margin-top: 10px; }
    .thumb { width: 40px; height: 40px; object-fit: cover; cursor: pointer; border: 1px solid #ddd; }
    .thumb:hover { border-color: var(--oro); }
</style>

<script>
function renderCatalog(category = 'Todos') {
    const catDiv = document.getElementById('catalogo');
    catDiv.innerHTML = '';
    const filtered = category === 'Todos' ? misProductos : misProductos.filter(p => p.cat === category);
    
    filtered.forEach(p => {
        const card = document.createElement('div');
        card.className = `joya-card ${currentJoya?.id === p.id ? 'selected' : ''}`;
        
        // Generamos miniaturas si hay más de una foto
        let thumbsHtml = '';
        if(p.imagenes && p.imagenes.length > 1) {
            thumbsHtml = `<div class="galeria-preview">` + 
                p.imagenes.map(img => `<img src="${img}" class="thumb" onclick="event.stopPropagation(); changeMainImg(this, '${p.id}')">`).join('') + 
                `</div>`;
        }

        card.innerHTML = `
            <img src="${p.imagenes[0]}" id="main-${p.id}">
            <div class="joya-info">
                <strong>${p.nombre}</strong>
                <span>$${p.precio} USD</span>
                ${thumbsHtml}
            </div>
        `;
        card.onclick = () => selectJoya(p);
        catDiv.appendChild(card);
    });
}

function changeMainImg(el, prodId) {
    document.getElementById(`main-${prodId}`).src = el.src;
}

function selectJoya(p) {
    if(!clientIdActual) {
        currentJoya = p;
        // La URL que se enviará a Telegram será la imagen que esté visible actualmente
        currentJoya.url = document.getElementById(`main-${p.id}`).src;
        renderCatalog(); 
        updatePrice();
    }
}
</script>
