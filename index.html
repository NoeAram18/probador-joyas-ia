<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GEDALIA | Fine Jewelry</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #c5a059; --black: #111; --gray: #f4f4f4; }
        body { font-family: 'Inter', sans-serif; background: #fff; color: var(--black); }
        h1, h2, h3 { font-family: 'Playfair Display', serif; }

        header { padding: 60px 20px; text-align: center; border-bottom: 1px solid #eee; }
        header h1 { font-size: 3rem; letter-spacing: 10px; text-transform: uppercase; }

        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 30px; padding: 40px; }
        .card { cursor: pointer; position: relative; transition: 0.4s; }
        .card img { width: 100%; height: 400px; object-fit: cover; }
        .promo-tag { position: absolute; top: 10px; left: 10px; background: var(--gold); color: white; padding: 5px 12px; font-size: 11px; letter-spacing: 1px; }

        /* MODAL PREMIUM */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; display: none; z-index: 2000; overflow-y: auto; }
        .modal-grid { display: grid; grid-template-columns: 1.2fr 1fr; height: 100vh; }
        .gallery-side { background: var(--gray); display: flex; align-items: center; justify-content: center; position: relative; }
        .gallery-side img { max-width: 80%; max-height: 80vh; object-fit: contain; }
        .close-btn { position: absolute; top: 30px; left: 30px; font-size: 24px; cursor: pointer; z-index: 10; }
        
        .content-side { padding: 80px; display: flex; flex-direction: column; justify-content: center; }
        .content-side h2 { font-size: 3rem; margin-bottom: 10px; }
        .price-row { font-size: 1.5rem; margin-bottom: 40px; }
        .old-price { text-decoration: line-through; color: #999; margin-right: 15px; }
        
        .buy-actions { display: flex; gap: 15px; margin-top: 30px; }
        .btn { padding: 18px 30px; border: none; cursor: pointer; font-weight: 600; text-transform: uppercase; letter-spacing: 2px; transition: 0.3s; flex: 1; }
        .btn-gold { background: var(--gold); color: white; }
        .btn-black { background: var(--black); color: white; }
        .btn:hover { opacity: 0.8; }

        .thumbs { position: absolute; bottom: 40px; display: flex; gap: 10px; }
        .thumbs img { width: 60px; height: 60px; border: 1px solid #ddd; cursor: pointer; background: #fff; }

        @media (max-width: 900px) { .modal-grid { grid-template-columns: 1fr; } .content-side { padding: 40px; } }
    </style>
</head>
<body>

<header>
    <h1>GEDALIA</h1>
    <p style="letter-spacing: 5px; color: #888;">ELEGANCIA ETERNA</p>
</header>

<div class="grid" id="catalogo"></div>

<div id="modal" class="modal">
    <div class="close-btn" onclick="closeModal()">‚úï</div>
    <div class="modal-grid" id="modal-content"></div>
</div>

<script>
    let prods = [];

    async function cargar() {
        const res = await fetch('/api/productos');
        prods = await res.json();
        render();
    }

    function render() {
        const div = document.getElementById('catalogo');
        div.innerHTML = prods.map(p => `
            <div class="card" onclick="openModal('${p._id}')">
                ${p.descuento > 0 ? `<div class="promo-tag">-${p.descuento}%</div>` : ''}
                ${p.envioGratis ? `<div class="promo-tag" style="top:40px">ENV√çO GRATIS</div>` : ''}
                <img src="${p.imagenes[0]}">
                <div style="padding:15px; text-align:center;">
                    <h3 style="letter-spacing:2px;">${p.nombre}</h3>
                    <p style="color:var(--gold)">$${p.precioBase} USD</p>
                </div>
            </div>
        `).join('');
    }

    async function openModal(id) {
        const p = prods.find(x => x._id === id);
        // Track view
        fetch(`/api/productos/view/${id}`, { method: 'POST' });

        const finalPrice = p.descuento > 0 ? p.precioBase * (1 - p.descuento/100) : p.precioBase;

        document.getElementById('modal-content').innerHTML = `
            <div class="gallery-side">
                <img src="${p.imagenes[0]}" id="main-img">
                <div class="thumbs">
                    ${p.imagenes.map(i => `<img src="${i}" onclick="document.getElementById('main-img').src='${i}'">`).join('')}
                </div>
            </div>
            <div class="content-side">
                <p style="color:var(--gold); letter-spacing:3px; margin-bottom:10px;">${p.categoria.toUpperCase()}</p>
                <h2>${p.nombre}</h2>
                <div class="price-row">
                    ${p.descuento > 0 ? `<span class="old-price">$${p.precioBase}</span>` : ''}
                    <span>$${finalPrice.toFixed(2)} USD</span>
                </div>
                <p style="line-height:1.8; color:#666; margin-bottom:40px;">Una pieza maestra dise√±ada para perdurar. Elaborada bajo los m√°s altos est√°ndares de calidad de la casa GEDALIA.</p>
                
                <div class="buy-actions">
                    <button class="btn btn-black" onclick="comprar('${p.nombre}', ${finalPrice}, 'Carrito')">A√±adir al Carrito</button>
                    <button class="btn btn-gold" onclick="comprar('${p.nombre}', ${finalPrice}, 'Compra R√°pida')">Compra R√°pida</button>
                </div>
                <p style="font-size:12px; color:#999; margin-top:20px;">üõ°Ô∏è Compra segura | Garant√≠a de autenticidad</p>
            </div>
        `;
        document.getElementById('modal').style.display = 'block';
    }

    async function comprar(nombre, monto, tipo) {
        await fetch('/api/comprar', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ cliente: "Usuario Web", joya: nombre, monto, tipo })
        });
        alert(`¬°Gracias! Se ha procesado tu ${tipo} para la pieza ${nombre}`);
    }

    function closeModal() { document.getElementById('modal').style.display = 'none'; }
    cargar();
</script>
</body>
</html>
